# Book Shopアプリケーション

書籍「クラウドネイティブで実現する マイクロサービス開発・運用実践」提供のハンズオンの学習用リポジトリ

## サービス構成

| サービス/コンポーネント   | 概要                                                                            |
| ------------------------- | ------------------------------------------------------------------------------- |
| カタログサービス          | 書籍のタイトル、著者名、値段など書籍情報を管理                                  |
| 注文サービス              | 注文の受付、注文履歴情報など、注文情報を管理                                    |
| 発送サービス              | 注文受付時に発送情報を管理                                                      |
| BFF(Backend for Frontend) | カタログサービス、注文サービスの2つのバックエンドと、フロントエンドの通信を集約 |
| フロントエンド            | ユーザインターフェースを構築                                                    |
| メッセージブローカー      | イベント駆動型通信におけるメッセージ送受信を管理                                |
| 認証サーバ                | ユーザーの認証情報を管理                                                        |

## 各コンポーネント(マイクロサービスの通信イメージ)

フロントエンド
=GraphQL=> BFF(バックエンドフォアフロントエンド)
==gRPC==> 注文 -> メッセージブローカー -> 発送
==gRPC==> カタログ
==> 認証サーバ

マイクロサービスはk8s(Kubernetes)上のPodにデプロイされる

## 環境構築

MacOSを前提

Goのインストール

```
$ brew install go
$ go version
go version go1.20.2 darwin/arm64
```

Protocol Buffersのインストール(gRPC)

```
$ brew install protbuf
$ protoc --version
libprotoc 3.21.12
```

kindのインストール

```
$ brew install kind
$ kind --version
kind version 0.23.0
```

istioのインストール

```
$ curl -L https://istio.io/downloadIstio | sh -
$ cd istio-1.24.2
$ echo 'export PATH="'$PWD'/bin:$PATH"' >> ~/.zshrc
$ source ~/.zshrc
$ istioctl version
Istio is not present in the cluster: no running Istio pods in namespace "istio-system"
client version: 1.24.2
```

## アプリケーションの実装

### gRPC

リモートプロセス上でメソッド呼び出しを行う。RPCフレームワークの一つとしてgRPCがある。

従来のリクエスト/レスポンス方の通信の場合、実装が素直なメリットがあるが、レスポンスを待つ間に処理がブロッキングされてしまうデメリットがある。

gRPCのようなイベント駆動型の通信ではあるマイクロサービスが発行したイベントを、別のマイクロサービスが利用する形式のためリクエスト/レスポンス型のような待ち時間が発生しないメリットがある。ただし、実装・通信面においてやや複雑になるデメリットがある。

gRPCはRPCの一種で、通信時に受け渡すデータの構造や型などを記述したインターフェース定義が必要になる。

gRPCは通信におけるクライアントとサーバの間のインターフェースを定義するために`Protocol Buffers`を使っている。

`Protocol Buffers`は構造化データをバイナリ形式にシリアライズすることもでき、gRPCの通信はバイナリ形式にシリアライズされるためJSONやXMLに比べて非常に小さいサイズでの通信が可能となる。
